<html>
<script>

//var STDOUT = '';

function runme() {

	console.log('testing 1 - Hello World!');
	document.getElementById('output').innerHTML = '';
	c('MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO Moo MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO Moo MoO MoO MoO MoO MoO MoO MoO Moo Moo MoO MoO MoO Moo OOO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO Moo MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO Moo MOo MOo MOo MOo MOo MOo MOo MOo MOo MOo MOo MOo MOo MOo MOo MOo MOo MOo MOo MOo MOo MOo MOo MOo MOo MOo MOo MOo MOo MOo MOo MOo MOo MOo MOo MOo MOo MOo MOo MOo MOo Moo MOo MOo MOo MOo MOo MOo MOo MOo Moo MoO MoO MoO Moo MOo MOo MOo MOo MOo MOo Moo MOo [[with comments]] MOo MOo MOo MOo MOo MOo MOo Moo OOO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO Moo');

	console.log('testing 2 - Fibonaci 1,1,2,3,5,8,1,3,2,1,...');
	document.getElementById('output').innerHTML += '<br>';
	c('MoO moO MoO mOo MOO OOM MMM moO moO MMM mOo mOo moO MMM mOo MMM moO moO MOO MOo mOo MoO moO moo mOo mOo moo');

	console.log('testing 3 - try to execute unknown command, should exit cleanly');
	document.getElementById('output').innerHTML += '<br>';
	c('OOO MOo mOO');

	console.log('testing 4 - Loop 3 times');
	document.getElementById('output').innerHTML += '<br>';
	c('MoO MoO MoO MOO MOo moo');

	console.log('testing 5 - test if current memPos value is 3 without affecting current');
	document.getElementById('output').innerHTML += '<br>';
	c('MoO MoO MoO MMM moO MMM moO OOO MoO MoO MoO MOO MOo mOo MOo moO moo mOo MOO mOo OOM moO OOO MOO moo mOo OOM moO OOO MOO moo moo mOo');

	console.log('testing 6 - load value and print it out as char and integer using both load methods');
	document.getElementById('output').innerHTML += '<br>';
	c('Moo OOM Moo MoO oom OOM Moo');

	console.log('testing 7 - test moo without MOO, clean exit');
	document.getElementById('output').innerHTML += '<br>';
	c('MoO moo');

	console.log('testing 8 - test MOO without moo, clean exit');
	document.getElementById('output').innerHTML += '<br>';
	c('MoO MoO MOO MoO MoO');

	console.log('testing 9 - Print 1,2,3,4,5 read from standard input (as chars)');
	document.getElementById('output').innerHTML += '<br>';
	c('Moo Moo moO Moo Moo moO Moo Moo moO Moo Moo moO Moo Moo');

	console.log('testing 10 - Print 1,2,3,4,5 read from standard input (as integers)');
	document.getElementById('output').innerHTML += '<br>';
	c('oom OOM moO oom OOM moO oom OOM moO oom OOM moO oom OOM');

	console.log('testing 11 - Replace \"mOO\" with instruction in memory, print 2,0');
	document.getElementById('output').innerHTML += '<br>';
	c('MoO MoO mOO mOo OOM moO OOM');

	console.log('testing 12 - Loop test with register: should print 3,3,3,0');
	document.getElementById('output').innerHTML += '<br>';
	c('MoO MoO MoO MMM moO MMM MOO MOo mOo OOM moO moo OOM');

	console.log('testing 13 - Loop test with register: should print 3,3,3,0');
	document.getElementById('output').innerHTML += '<br>';
	c('moOMoOMoOMoOMoOmoOMoOMoOMoOMoOMoOMoOMoOMoOMoOMoOMMMmoOMMMMoOMoOMoOMoOMoOMoOMoOMoOMoOMoOMoOMoOMoOMoOMoOMoOMoOMoOMoOMoOMoOMoOMMMmoOMMMommMoOMoOMoOMoOMoOMoOMoOMoOMoOMoOMoOMoOMMMmoOMMMMoOMoOMMMmoOMMMMoOMoOMoOMoOMoOMoOMoOMoOMoOMoOMoOMoOMoOMoOMoOMoOMoOMoOMoOMoOMoOMoOMoOMoOMoOMoOMoOMoOMoOMoOMoOMoOMoOMoOMoOMoOMoOMoOMoOMoOMoOMoOMoOMoOMoOMoOMoOMoOMoOMoOMoOMMMmoOMMMMoOMMMmOomOomOomOomOomOoMMMMoOmoOmoOmoOmoOmoOmoOMMMmoOMMMMoOMoOMMMmoOMMMMoOMMMmoOMMMMoOMMMmoOMMMMoOMoOMMMmoOMMMMoOMMMmoOMMMMoOMoOMMMmoOMMMMoOMMMmoOMMMMoOMoOMMMmoOMMMMoOMMMmoOMMMMoOMMMmoOMMMMoOMoOMMMmoOMMMMoOMMMmoOMMMMoOMMMmoOMMMMoOMMMmoOMMMMoOMoOmOomOomOomOomOomOomOomOomOomOomOomOomOomOomOomOomOomOomOomOomOoMOOOOMmoOmoOmoOmoOmoOmoOMoomoOmoOmoOmoOmoOmoOmoOmoOmoOMoomoOmoOmoOmoOMooMoomOomOomOomOomOomOoMoomOomOomOomOomOoMoomOomOomOomOomOomOomOomOoMMMMOoMOOmoOmoOmoOmoOmoOmoOmoOmoOmoOmoOmoOmoOmoOmoOmoOmoOmoOmoOMoomOomOomOomOomOomOomOomOomOomOomOomOomOomOomOomOomOomOoOOOmooMMMmoOmoOmoOmoOmoOmoOmoOmoOmOomOomOomOomOomOoMoomoOmoOmoOmoOmoOmoOmoOmoOmoOmoOmoOmoOmoOMoomOomOomOomOomOomOoMoomOomOomOomOomOomOomOoMoomoOmoOmoOmoOMoomoOmoOMooMoomoOmoOmoOmoOmoOmoOmoOmoOmoOMoomOomOomOomOomOomOomOomOomOomOomOomOomOomOomOoMoomoOmoOmoOmoOmoOmoOmoOmoOmoOmoOmoOmoOmoOMoomOoMoomOomOomOomOomOomOomOomOomOomOomOomOoMoomoOmoOmoOmoOmoOmoOmoOmoOmoOmoOmoOmoOmoOmoOmoOmoOmoOMoomOomOomOomOomOomOomOomOomOoMoomOomOoMoomOomOomOomOomOomOoMoomoOmoOmoOmoOmoOmoOmoOmoOmoOmoOmoOmoOmoOmoOmoOmoOmoOmoOmoOMoomOomOomOomOomOomOomOomOomOomOomOomOomOomOomOomOoMoomoOmoOmoOmoOmoOmoOmoOmoOMooMoomOomOomOomOomOomOomOomOomOomOoMoomOomOoMoomOoOOMmoOmoOmoOmoOmoOmoOMoomoOmoOmoOmoOmoOmoOmoOmoOmoOMoomoOmoOmoOmoOMooMoomOomOomOomOomOomOoMoomOomOomOomOomOoMoomOomOomOomOomOomOomOomOoMMMMOoMOOmoOmoOmoOmoOmoOmoOmoOmoOmoOmoOmoOmoOmoOmoOmoOmoOmoOmoOMoomOomOomOomOomOomOomOomOomOomOomOomOomOomOomOomOomOomOoOOOmooMMMmoOmoOmoOmoOmoOmoOmoOmoOmOomOomOomOomOomOoMoomoOmoOmoOmoOmoOmoOmoOmoOmoOmoOmoOmoOmoOMoomOomOomOomOomOomOoMoomOomOomOomOomOomOomOoMoomoOmoOmoOmoOMoomoOmoOMooMoomoOmoOmoOmoOmoOmoOmoOmoOmoOMoomOomOomOomOomOomOomOomOomOomOomOomOomOomOoMoomOomOoMoomoOmoOmoOmoOmoOmoOmoOmoOmoOmoOmoOmoOmoOmoOmoOmoOmoOmoOMoomOomOomOomOomOomOomOomOomOomOomOomOomOomOoMoomoOmoOmoOmoOmoOmoOmoOMoomOomOomOomOoMoomOomOomOomOomOomOoMoomOomOoMMMmOoOOOMoOmoOMOoMOOmoOmoOmoOmoOmoOmoOmoOmoOmoOmoOmoOmoOmoOmoOmoOMoomOoMoomOomOomOomOomOomOoMoomOomOomOomOomOomOomOomOomOoOOOmoOOOOmooMMMmOoMOOmoOmoOmoOmoOmoOmoOmoOmoOmoOmoOmoOmoOMoomoOmoOmoOmoOmoOmoOmoOmoOMoomOomOomOomOomOomOomOomOomOomOomOomOomOomOomOomOomOomOomOomOoOOOmoomoOmoOmoOMoomoOmoOmoOmoOmoOMoomoOmoOmoOmoOmoOmoOmoOmoOMoomoOmoOmoOmoOmoOmoOMoomOomOomOomOomOomOomOoMoomOomOomOomOomOomOomOomOomOomOomOoMoomOoMoomoOmoOmoOmoOmoOmoOmoOmoOmoOmoOmoOmoOmoOmoOMoomOomOomOomOomOomOomOomOomOomOomOoMoomoOmoOmoOmoOmoOmoOmoOmoOmoOmoOmoOmoOmoOMooMoomOomOomOomOomOomOomOomOomOomOomOomOomOomOomOomOoMoomoOmoOmoOmoOmoOmoOmoOmoOmoOMoomoOmoOmoOmoOmoOmoOmoOmoOMoomOomOomOomOomOomOomOomOomOomOomOomOomOomOomOomOomOoMoomoOmoOmoOMoomoOmoOmoOmoOmoOmoOmoOmoOmoOmoOmoOmoOMoomOomOoMoomoOmoOmoOmoOmoOMoomOomOomOomOomOomOoMoomOomOomOomOomOomOomOoMoomOomOomOomOoMoomOomOoMoomOoMOoOOMmoOmoOmoOmoOmoOmoOMoomoOmoOmoOmoOmoOmoOmoOmoOmoOMoomoOmoOmoOmoOMooMoomOomOomOomOomOomOoMoomOomOomOomOomOoMoomOomOomOomOomOomOomOomOoMMMMOoMOOmoOmoOmoOmoOmoOmoOmoOmoOmoOmoOmoOmoOmoOmoOmoOmoOmoOmoOMoomOomOomOomOomOomOomOomOomOomOomOomOomOomOomOomOomOomOoOOOmooMMMmoOmoOmoOmoOmoOmoOmoOmoOmOomOomOomOomOomOoMoomoOmoOmoOmoOmoOmoOmoOmoOmoOmoOmoOmoOmoOMoomOomOomOomOomOomOoMoomOomOomOomOomOomOomOoMoomoOmoOmoOmoOMoomoOmoOMooMoomoOmoOmoOmoOmoOmoOmoOmoOmoOMoomOomOomOomOomOomOomOomOomOomOomOomOomOomOomOoMoomoOmoOmoOmoOmoOmoOmoOmoOmoOmoOmoOmoOmoOMoomOoMoomOomOomOomOomOomOomOomOomOomOomOomOoMoomoOmoOmoOmoOmoOmoOmoOmoOmoOmoOmoOmoOmoOmoOmoOmoOmoOMoomOomOomOomOomOomOomOomOomOoMoomOomOoMoomOomOomOomOomOomOoMoomoOmoOmoOmoOmoOmoOmoOmoOmoOmoOmoOmoOmoOmoOmoOmoOmoOmoOmoOMoomOomOomOomOomOomOomOomOomOomOomOomOomOomOomOomOoMoomoOmoOmoOmoOmoOmoOmoOmoOMooMoomOomOomOomOomOomOomOomOomOoMoomOomOomOoMooMoomOomoo');

	console.log('testing 14 - infinity counter');
	document.getElementById('output').innerHTML += '<br>';
	c('MoO MOO moO OOM MoO mOo moo');

	console.log('testing 15 - print Frank!');
	document.getElementById('output').innerHTML += '<br>';
	c('OOO MoO MoO MoO MoO MoO MoO MoO MoO MMM moO MMM MMM moO MMM MOO MOo mOo MoO moO moo mOo MMM moO MMM MMM moO MMM MOO MOo mOo MoO moO moo mOo MMM moO MMM MMM moO MMM MOO MOo mOo MoO moO moo OOO MoO MoO MoO MoO MoO MoO mOo MMM moO moO MMM MOO MOo mOo MoO moO moo mOo Moo mOo MMM moO MMM mOo mOo MMM moO moO moO MMM MOO MOo mOo MoO moO moo mOo MMM moO MMM MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO Moo mOo MMM moO MMM MoO Moo mOo MMM moO MMM MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO Moo MOo MOo MOo Moo');


	console.log('testing 16 - loop skip test');
	document.getElementById('output').innerHTML += '<br>';
	c('OOO MOO moo moo');

	console.log('testing 17 - should print 3 2 1');
	document.getElementById('output').innerHTML += '<br>';
	c('MoO MoO MoO MOO OOM MOo moo');

	console.log('testing 18 - Invalid replacement of \"mOO\" with itself, should abort (and print nothing)');
	document.getElementById('output').innerHTML += '<br>';
	c('MoO MoO MoO mOO OOM');
	
	console.log('testing 19 - garbage program');
	document.getElementById('output').innerHTML += '<br>';
	c('mOos21312mafiosntewtewo');

	console.log('testing 20 - print Frank$#&$#!');
	document.getElementById('output').innerHTML += '<br>';
	c('OOO MoO MoO MoO MoO MoO MoO MoO MoO MMM moO MMM MMM moO MMM MOO MOo mOo MoO moO moo mOo MMM moO MMM MMM moO MMM MOO MOo mOo MoO moO moo mOo MMM moO MMM MMM moO MMM MOO MOo mOo MoO moO moo OOO MoO MoO MoO MoO MoO MoO mOo MMM moO moO MMM MOO MOo mOo MoO moO moo mOo Moo mOaMM moO MMM mOo mOo MMM moO moO moO MMM MOO MOo mOo MoO moO moo mOo MMM moO MMM MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO Moo mOo MMM moO MMM MoO Moo mOo MMM moO MMM MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO MoO Moo MOo MOo MOo Moo');
	
	//document.getElementById('output').innerHTML += STDOUT;
}

//function input_char() {
//return 97;
//}

//function output_char(output) {
//document.getElementById('output').innerHTML += output[0];
//alert(output);
//}

function output_char(ch) {
	document.getElementById('output').innerHTML += ch[0];
    //console.log(ch);
	//alert(ch);
}

var input_char = (function () {
  var i = 0;
  var text = 'aa12345';
  return function input_char() {
    return text[i++ % text.length].charCodeAt(0);
  };
}());

function c(cowIn) {

	function print(text) {
		//result = result + text
		for (var i=0; i< text.length; i++) output_char(text[i]);
	}

	function newline(text) {
		//result = result + "\n"
		output_char('\n');
	}

	function printChar(code)  {
		//print(String.fromCharCode(code))
		output_char(String.fromCharCode(code));
	}

	function printNumber(number) {
		print(number)
		newline()
	}

	function exec(instruction) {
		switch (instruction) {
			// moo
			case 0:
				if (progPos == 0) {
					return false
				} else {
					progPos--  // skip previous command.
					level = 1
					while (level > 0) {
						if (progPos == 0) {
							break
						}
						progPos--
						if (cowProgram[progPos] == 0) {
							level++
						} else if (cowProgram[progPos] == 7) {  // look for MOO
							level--
						}
					}
					if (level != 0) {
						return false
					}
					return exec(cowProgram[progPos])
				}
				break
		
			// mOo
			case 1:
				if (memPos == 0) {
					return false
				} else {
					memPos--
				}
				break

			// moO
			case 2:
				memPos++
				if (memPos == memory.length) {
					memory.push(0)
				}
				break
		
			// mOO    
			case 3:
				if (memory[memPos] == 3) {
					return false
				} else {
					return exec(memory[memPos])
				}
				break
		
			// Moo
			case 4:
				if (memory[memPos] != 0) {
					printChar(memory[memPos])
				} else {
					//memory[memPos] = Text.charCodeAt(window.prompt("please enter a character"))
					memory[memPos] = input_char();
				}
				break
			
			// MOo
			case 5:
				memory[memPos]--
				break
			
			// MoO
			case 6:
				memory[memPos]++
				break
			
			// MOO
			case 7:
				if (memory[memPos] == 0) {
					var level = 1
					var prev = 0
					progPos++  // have to skip past next command when looking for next moo.
					if (progPos == cowProgram.length) {
						break
					}
					while (level > 0) {
						prev = cowProgram[progPos]
						progPos++
						if (progPos == cowProgram.length) {
							break
						}
						if (cowProgram[progPos] == 7) {
							level++
						} else {
							if (cowProgram[progPos] == 0) {  // look for moo command.
								level--
								if (prev == 7) {
									level--
								}
							}
						}
					}
					if (level != 0) {
						return false
					}
				}
				break
			
			// OOO
			case 8:
				memory[memPos] = 0
				break
			
			// MMM
			case 9:
				if (registerVal == undefined) {
					registerVal = memory[memPos]
				} else {
					memory[memPos] = registerVal
					registerVal = undefined
				}
				break
			
			// OOM
			case 10:
				//printNumber(memory[memPos])
				print(memory[memPos]+'');
				break
			
			// oom
			case 11:
				//memory[memPos] = parseFloat(window.prompt("please enter a number"))
				memory[memPos] = parseFloat(input_char());
				break
			
			// bad stuff
			default:
				return false
		}
		progPos++
		return true
	}

	// read program
	result = ""
	var tokens = [ "moo", "mOo", "moO", "mOO", "Moo", "MOo",
		"MoO", "MOO", "OOO", "MMM", "OOM", "oom"]
	//cowIn = document.getElementById("CowProgram")
	var token = "   "
	cowProgram = new Array()
	for (var i = 0; i < cowIn.length; i++) {
		token = token.substring(1) + cowIn.charAt(i)
		for (var j = 0; j < tokens.length; j++) {
			if (tokens[j] == token) {
				cowProgram.push(j)
				token = "   "
				break
			}
		}
	}

	// execute
	progPos = 0
	registerVal = undefined
	memory = new Array()
	memPos = 0
	memory.push(0)
	var counter = 0;
	while (progPos != cowProgram.length) {
		counter++;
		if (counter > 3000) break;
		if (!exec(cowProgram[progPos])) {
			break
		}
	}
	//newline()
	//print("Done.")
	//cowOut = document.getElementById("CowResult")
	//cowOut.value = result
}

</script>
<body>
	<input type="button" onclick="runme()" value="click me"/><br>
	<div id="output"></div>
</body>